<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聊天应用</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .auth-container, .chat-container {
            display: none;
            flex-direction: column;
            height: 600px;
        }
        
        .auth-container.active, .chat-container.active {
            display: flex;
        }
        
        .auth-form {
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex: 1;
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .auth-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: none;
            border: none;
            font-size: 18px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        h2 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 500;
            color: #555;
        }
        
        input {
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-logout {
            background: #6b7280;
            color: white;
        }
        
        .message {
            padding: 10px 15px;
            border-radius: 10px;
            margin: 5px 0;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .message.own {
            background: #667eea;
            color: white;
            align-self: flex-end;
        }
        
        .message.other {
            background: #f3f4f6;
            color: #333;
            align-self: flex-start;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            background: #f9fafb;
        }
        
        .chat-input-container {
            padding: 20px;
            border-top: 2px solid #f0f0f0;
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
        }
        
        .message-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .message-username {
            font-weight: bold;
            font-size: 14px;
        }
        
        .message-time {
            font-size: 12px;
            color: #9ca3af;
        }
        
        .delete-btn {
            padding: 4px 8px;
            font-size: 12px;
            background: rgba(0,0,0,0.1);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .message:hover .delete-btn {
            opacity: 1;
        }
        
        .current-user {
            font-weight: 600;
            color: #667eea;
        }
        
        .alert {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fca5a5;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #059669;
            border: 1px solid #6ee7b7;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 登录/注册界面 -->
        <div class="auth-container active" id="authContainer">
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showLogin()">登录</button>
                <button class="auth-tab" onclick="showRegister()">注册</button>
            </div>
            
            <form class="auth-form" id="loginForm">
                <h2>欢迎回来</h2>
                <div class="alert" id="loginAlert" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="loginUsername">用户名</label>
                    <input type="text" id="loginUsername" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">密码</label>
                    <input type="password" id="loginPassword" required>
                </div>
                
                <button type="submit" class="btn-primary">登录</button>
            </form>
            
            <form class="auth-form" id="registerForm" style="display: none;">
                <h2>创建账户</h2>
                <div class="alert" id="registerAlert" style="display: none;"></div>
                
                <div class="form-group">
                    <label for="registerUsername">用户名</label>
                    <input type="text" id="registerUsername" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">密码</label>
                    <input type="password" id="registerPassword" required>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">确认密码</label>
                    <input type="password" id="confirmPassword" required>
                </div>
                
                <button type="submit" class="btn-primary">注册</button>
            </form>
        </div>
        
        <!-- 聊天界面 -->
        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                <div>
                    <h3>聊天室</h3>
                    <p>当前用户: <span class="current-user" id="currentUsername"></span></p>
                </div>
                <button class="btn-logout" onclick="logout()">退出登录</button>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <!-- 消息会动态添加到这里 -->
            </div>
            
            <div class="chat-input-container">
                <input type="text" 
                       class="chat-input" 
                       id="messageInput" 
                       placeholder="输入消息..."
                       onkeypress="if(event.key === 'Enter') sendMessage()">
                <button class="btn-primary" onclick="sendMessage()">发送</button>
            </div>
        </div>
    </div>

    <script>
        // 模拟"数据库" - 使用localStorage存储用户和消息
        class Database {
            constructor() {
                this.initStorage();
            }
            
            initStorage() {
                if (!localStorage.getItem('users')) {
                    localStorage.setItem('users', JSON.stringify({}));
                }
                if (!localStorage.getItem('messages')) {
                    localStorage.setItem('messages', JSON.stringify([]));
                }
            }
            
            // 用户相关方法
            getUser(username) {
                const users = JSON.parse(localStorage.getItem('users'));
                return users[username];
            }
            
            saveUser(username, password) {
                const users = JSON.parse(localStorage.getItem('users'));
                users[username] = { username, password };
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            // 消息相关方法
            saveMessage(message) {
                const messages = JSON.parse(localStorage.getItem('messages'));
                messages.push(message);
                localStorage.setItem('messages', JSON.stringify(messages));
            }
            
            getMessages() {
                return JSON.parse(localStorage.getItem('messages'));
            }
            
            deleteMessage(messageId, username) {
                const messages = JSON.parse(localStorage.getItem('messages'));
                const index = messages.findIndex(msg => 
                    msg.id === messageId && msg.sender === username
                );
                
                if (index !== -1) {
                    messages.splice(index, 1);
                    localStorage.setItem('messages', JSON.stringify(messages));
                    return true;
                }
                return false;
            }
        }
        
        const db = new Database();
        let currentUser = null;
        
        // 显示登录表单
        function showLogin() {
            document.getElementById('loginForm').style.display = 'flex';
            document.getElementById('registerForm').style.display = 'none';
            
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.auth-tab')[0].classList.add('active');
            
            document.getElementById('loginAlert').style.display = 'none';
        }
        
        // 显示注册表单
        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'flex';
            
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.auth-tab')[1].classList.add('active');
            
            document.getElementById('registerAlert').style.display = 'none';
        }
        
        // 登录
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const alertDiv = document.getElementById('loginAlert');
            
            if (!username || !password) {
                showAlert(alertDiv, '请输入用户名和密码', 'error');
                return;
            }
            
            const user = db.getUser(username);
            
            if (!user || user.password !== password) {
                showAlert(alertDiv, '用户名或密码错误', 'error');
                return;
            }
            
            // 登录成功
            currentUser = user;
            document.getElementById('currentUsername').textContent = currentUser.username;
            document.getElementById('authContainer').classList.remove('active');
            document.getElementById('chatContainer').classList.add('active');
            loadMessages();
            
            // 清空表单
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        });
        
        // 注册
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const alertDiv = document.getElementById('registerAlert');
            
            if (!username || !password) {
                showAlert(alertDiv, '请输入用户名和密码', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showAlert(alertDiv, '两次输入的密码不一致', 'error');
                return;
            }
            
            if (db.getUser(username)) {
                showAlert(alertDiv, '用户名已存在', 'error');
                return;
            }
            
            // 注册成功
            db.saveUser(username, password);
            showAlert(alertDiv, '注册成功，请登录', 'success');
            
            // 清空表单
            document.getElementById('registerUsername').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            // 切换到登录界面
            setTimeout(showLogin, 1500);
        });
        
        // 发送消息
        function sendMessage() {
            if (!currentUser) return;
            
            const input = document.getElementById('messageInput');
            const content = input.value.trim();
            
            if (!content) return;
            
            const message = {
                id: Date.now(),
                sender: currentUser.username,
                content: content,
                timestamp: new Date().toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                })
            };
            
            db.saveMessage(message);
            input.value = '';
            loadMessages();
        }
        
        // 加载消息
        function loadMessages() {
            const messagesContainer = document.getElementById('chatMessages');
            const messages = db.getMessages();
            
            messagesContainer.innerHTML = '';
            
            messages.forEach(msg => {
                const isOwnMessage = msg.sender === currentUser.username;
                const messageElement = document.createElement('div');
                messageElement.className = `message ${isOwnMessage ? 'own' : 'other'}`;
                
                messageElement.innerHTML = `
                    <div class="message-info">
                        <span class="message-username">${msg.sender}</span>
                        <span class="message-time">${msg.timestamp}</span>
                    </div>
                    <div>${msg.content}</div>
                    ${isOwnMessage ? `<button class="delete-btn" onclick="deleteMessage(${msg.id})">撤回</button>` : ''}
                `;
                
                messagesContainer.appendChild(messageElement);
            });
            
            // 滚动到底部
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // 删除消息
        function deleteMessage(messageId) {
            if (db.deleteMessage(messageId, currentUser.username)) {
                loadMessages();
            }
        }
        
        // 退出登录
        function logout() {
            currentUser = null;
            document.getElementById('chatContainer').classList.remove('active');
            document.getElementById('authContainer').classList.add('active');
            showLogin();
        }
        
        // 显示提示
        function showAlert(element, message, type) {
            element.textContent = message;
            element.className = `alert alert-${type}`;
            element.style.display = 'block';
        }
        
        // 初始化
        window.addEventListener('load', function() {
            // 检查是否已有用户登录（在页面刷新后保持登录状态）
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                const user = JSON.parse(savedUser);
                if (db.getUser(user.username)) {
                    currentUser = user;
                    document.getElementById('currentUsername').textContent = currentUser.username;
                    document.getElementById('authContainer').classList.remove('active');
                    document.getElementById('chatContainer').classList.add('active');
                    loadMessages();
                }
            }
            
            // 监听Enter键发送消息
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        });
        
        // 页面卸载前保存当前用户
        window.addEventListener('beforeunload', function() {
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
        });
    </script>
</body>
</html>
